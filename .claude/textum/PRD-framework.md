# [项目名称] - PRD v2.0

> 目标: 用**最少文字**写清**可开发规格**；禁止长段落复述；优先表格/清单；每条需求/规则/字段/错误码尽量一行。
> 稳定ID: 模块 `M-xx`；规则 `BR-###`；表 `TBL-###`；接口 `API-###`（001 起递增且唯一）。
> PRD 引用: Story 中引用 PRD 统一使用 `PRD#<ID>`（如 `PRD#API-001` / `PRD#TBL-001` / `PRD#BR-001`）。
> 块边界（必须）: PRD 中每个表/接口必须在其详情小节标题中包含对应 `TBL-###` / `API-###`，并追加 HTML 注释锚点 `<!-- PRD#TBL-### -->` / `<!-- PRD#API-### -->`；块内容不要跨多个 ID（便于按锚点唯一定位、避免通读）。
> 体积控制（强约束）:
> - 通用约定只写一次：优先放在第 4/6/7/9.1/10 节；避免在每个模块/接口重复。
> - API/表详情只写“可实现所需最小集合”：字段表 + 关键约束/失败场景；不要粘贴大段 JSON 示例。

## 1. 项目概述

### 1.1 一句话简介
[1-2 句话描述项目做什么、给谁用、解决什么问题]

### 1.2 目标（Goals）
- [G-01] [目标描述（可验证）]
- [G-02] [...]

### 1.3 非目标（Non-goals）
- [NG-01] [明确不做什么，防止范围蔓延]
- [NG-02] [...]

## 2. 范围与假设

### 2.1 交付范围（In Scope）
- [S-01] [...]
- [S-02] [...]

### 2.2 不在范围（Out of Scope）
- [OS-01] [...]
- [OS-02] [...]

### 2.3 关键假设与约束
| ID | 假设/约束 | 影响 |
|----|-----------|------|
| A-01 | [例如：必须支持移动端浏览器] | [对技术/交付的影响] |
| A-02 | [...] | [...] |

## 3. 目标用户与角色

### 3.1 用户角色
| 角色 | 描述 | 典型场景 |
|------|------|----------|
| [Role-01] | [是谁] | [会做什么] |
| [Role-02] | [...] | [...] |

## 4. 权限矩阵（必填）

> 记号建议: `A=允许` `D=禁止` `O=仅自己的/所属组织(或资源范围)`（也可按项目自定义，但需统一）
> 要求: 所有写到第 9 节接口的权限，都必须能在此表中找到对应操作（Operation）与范围规则。

| 操作 | [Role-01] | [Role-02] | [Role-N] | 说明 |
|------|-----------|-----------|----------|------|
| [Resource]:Create | A/D/O | A/D/O | A/D/O | [...] |
| [Resource]:Read | A/D/O | A/D/O | A/D/O | [...] |
| [Resource]:Update | A/D/O | A/D/O | A/D/O | [...] |
| [Resource]:Delete | A/D/O | A/D/O | A/D/O | [...] |

## 5. 核心功能

### 5.1 功能清单（必填）
| 模块ID | 模块名 | 一句话说明 | 优先级 | 依赖 |
|--------|--------|------------|--------|------|
| M-01 | [模块名] | [说明] | [P0/P1/P2] | [无 / M-xx] |
| M-02 | [...] | [...] | [...] | [...] |

### 5.2 功能规格（按模块填写）

#### 5.2.1 [M-01 模块名]
**功能点（尽量一行一条）**
- [FP-01] [...]
- [FP-02] [...]

**关键场景/验收（必填；建议用表格，便于测试与拆 Story）**
| 场景ID | 参与者 | 前置条件（Given） | 用户操作（When） | 系统响应（Then） | 失败/边界 | 备注 |
|--------|--------|-------------------|------------------|------------------|----------|------|
| SC-01 | [角色] | [...] | [...] | [...] | [...] | [...] |
| SC-02 | [...] | [...] | [...] | [...] | [...] | [...] |

**页面/路由（可选；只列清单，不写长文）**
| 路由 | 页面/入口说明 |
|------|----------------|
| [/path] | [...] |

#### 5.2.2 [M-02 模块名]
（按 5.2.1 结构重复）

## 6. 业务规则（必填）

> 规则编号格式: `BR-###`（三位数字，001 起递增且唯一）。
> 写作要求: 规则必须可执行/可测试；每条规则尽量一行；复杂规则拆成多条并各自编号；不要写散文。

| 规则ID | 规则描述 | 适用范围（模块/对象） | 例外/备注 |
|--------|----------|------------------------|----------|
| BR-### | [...] | [M-xx / 表/接口] | [...] |
| BR-### | [...] | [...] | [...] |

## 7. 状态与枚举（必填）

### 7.1 枚举值
| 字段（表.字段/上下文） | 可选值 | 默认值 | 说明 |
|------------------------|--------|--------|------|
| `[table].[field]` | `val1`, `val2` | `val1` | [...] |

### 7.2 状态机（流程型实体必填）
**[实体名] 状态流转**
```
[State A] -> [State B] -> [State C]
```

| 当前状态 | 触发事件 | 下一状态 | 权限/条件 | 备注 |
|----------|----------|----------|----------|------|
| [A] | [事件] | [B] | [Role/条件] | [...] |

## 8. 数据模型（必填）

### 8.1 表清单（可选）
| 表ID | 表名 | 用途 | 主要字段（摘要） |
|------|------|------|------------------|
| `TBL-###` | `[table]` | [...] | `id`, `...` |

### 8.2 表定义（逐表填写，便于按 `TBL-###` 定位）

> 写法建议: 字段表是“最终事实”；不要在描述里重复字段表内容；只补充约束/索引/边界语义。

#### 8.2.1 `TBL-###` `[table_name]` <!-- PRD#TBL-### -->
**用途（必填，一句话）**: [...]

| 字段 | 类型 | 可空 | 默认值 | 约束/索引 | 说明 |
|------|------|------|--------|----------|------|
| `id` | INTEGER PK | N |  | PK | 主键 |
| `[field]` | [类型] | [Y/N] | [默认] | [UNIQUE/FK/INDEX] | [说明] |

**关键约束（必填；无则写 N/A）**
| ID | 约束 | 说明 |
|----|------|------|
| CON-01 | [...] | [...] |

**关键索引（必填；无则写 N/A）**
| ID | 索引 | 用途 |
|----|------|------|
| IDX-01 | [...] | [...] |

#### 8.2.2 `TBL-###` `[table_name_2]` <!-- PRD#TBL-### -->
（按 8.2.1 结构重复）

### 8.3 表关系
```
[表A] 1──n [表B] n──1 [表C]
```

## 9. 接口设计（必填）

### 9.1 通用约定（必填）
**基础**
- Base URL: `[例如: /api]`
- 认证方式: [JWT/Cookie/Session/...]
- 权限校验: [按第 4 节权限矩阵执行]

**分页/排序/筛选（如有）**
- 分页参数: `page`, `pageSize`（或 `cursor`）
- 排序参数: `sort`, `order`
- 筛选参数: [约定字段与语义]

**响应包装（如有）**
```json
{ "data": {}, "message": "" }
```

**错误码（必填）**
| 状态码 | 业务含义 | 典型触发 |
|--------|----------|----------|
| 400 | [Bad Request] | [参数校验失败] |
| 401 | [Unauthorized] | [未登录/Token无效] |
| 403 | [Forbidden] | [无权限] |
| 404 | [Not Found] | [资源不存在] |
| 409 | [Conflict] | [唯一约束冲突/状态冲突] |

### 9.2 接口清单（必填）
| 接口ID | 名称 | 方法&路径 | 模块 | 权限 | 说明 |
|--------|------|----------|------|------|------|
| `API-###` | [接口名] | `[METHOD] /api/...` | [M-xx] | [Role/Operation] | [...] |

### 9.3 接口详情（逐个填写，便于按 `API-###` 定位）

> 写法建议: 不写长段“文字描述”；优先字段表；只补充关键规则与失败/边界场景。

#### 9.3.1 `API-###` [接口名称] <!-- PRD#API-### -->
- **方法&路径**: `[METHOD] /api/...`
- **模块**: [M-xx]
- **权限**: [Operation + 范围规则（与第 4 节一致）]

**请求（必填；无则写 N/A）**
| 位置 | 字段 | 类型 | 必填 | 约束 | 说明 |
|------|------|------|------|------|------|
| path/query/body | [field] | [type] | Y/N | [...] | [...] |

**响应（必填；无则写 N/A）**
| 字段 | 类型 | 说明 |
|------|------|------|
| [field] | [type] | [...] |

**失败/边界（必填）**
| 状态码 | 触发条件 | 对用户的提示（如有） |
|--------|----------|------------------------|
| 4XX/5XX | [...] | [...] |

#### 9.3.2 `API-###` [接口名称2] <!-- PRD#API-### -->
（按 9.3.1 结构重复）

## 10. 非功能需求（必填，可写 N/A）
| 类别 | 需求 | 验收口径 |
|------|------|----------|
| 安全 | [例如：敏感字段加密/脱敏] | [如何验证] |
| 审计 | [例如：记录关键管理操作] | [日志字段/保留期] |
| 性能 | [例如：列表接口 < 300ms(P95)] | [压测口径] |
| 可观测 | [例如：关键链路有 traceId] | [日志/指标] |
