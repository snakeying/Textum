# 阶段1c: PRD 校验

读取 `docs/PRD.md`，输出 `FAIL/DECISION/PASS` 清单用于回到 `/prd` 补齐；**不修改任何文件**。

## 读取

- `docs/PRD.md`

## 输出规则（只读）

- 不输出 PRD 原文
- 若存在任何 `FAIL`：
  - 输出 `FAIL` 清单（`F-001` 起编号）
  - 末尾追加：
    - `下一步：/prd`
    - `重跑：/prd-check`
  - 然后结束
- 仅当无 `FAIL`：输出 `DECISION`（若有）或 `PASS`

## FAIL 校验项（机械性门禁）

### 0) 文件存在

- `docs/PRD.md` 必须存在

### 1) 结构完整性（不得缺章）

必须包含以下一级章节（缺失即 `FAIL`）：

- `## 1. 项目概述`
- `## 2. 范围与假设`
- `## 3. 目标用户与角色`
- `## 4. 权限矩阵（必填）`
- `## 5. 核心功能`
- `## 6. 业务规则（必填）`
- `## 7. 状态与枚举（必填）`
- `## 8. 数据模型（必填）`
- `## 9. 接口设计（必填）`
- `## 10. 非功能需求（必填，可写 N/A）`

### 2) 模板占位符（不得残留）

在非代码块内容中（忽略 ``` fenced code blocks），不得残留任何模板占位符；命中即 `FAIL`。

机械拦截（任一命中即 `FAIL`）：
- `[...]`
- `PRD#API-###` / `PRD#TBL-###` / `PRD#BR-###`
- `API-###` / `TBL-###` / `BR-###`（仍为 `###` 占位）
- 方括号使用规则（避免误伤路由/路径）：在非代码块内容中，若出现 `[` 或 `]`：
  - 允许：Markdown 链接 `[text](...)`
  - 允许：编号标签 `[(G|NG|S|OS|FP)-NN]`（如 `[G-01]`）
  - 允许：路径/路由/落点等“包含 `/` 或 `\\` 的字符串”中的方括号（如 `/posts/[slug]`、`FILE:content/[slug].md`）
  - 其余一律视为模板占位符残留 → `FAIL`

### 3) 稳定ID（接口/表）一致性

**接口（如适用；无 API 必须写 N/A）**

先判断 PRD 是否有接口：
- 若 PRD `9.2 接口清单` 内容为 `N/A`：`PRD_HAS_API = false`
- 否则：`PRD_HAS_API = true`

若 `PRD_HAS_API = false`：
- 第 9 节 `9.1/9.2/9.3` 内容必须全部为 `N/A`
- PRD 中不得出现任何 `API-###` / `API-001` 或 `<!-- PRD#API-... -->`

若 `PRD_HAS_API = true`：
  - PRD `9.2 接口清单`：必须至少 1 条接口；每条接口必须有且仅有一个 `API-###`，且必须是具体数字（`API-001` 形式）；禁止缺失/重复/仍为 `API-###`
  - PRD `9.3 接口详情`：每个详情标题必须包含对应的 `API-###`
  - PRD `9.3 接口详情`：每个接口详情标题行必须以 `#### 9.3.` 开头（标题级别/前缀固定；用于后续按块边界机械抽取）
  - PRD `9.3 接口详情`：每个详情标题行必须包含对应的锚点 `<!-- PRD#API-### -->`（具体数字：`<!-- PRD#API-001 -->` 形式），且锚点 `<ID>` 必须与标题中的 `API-###` 一致；用于后续按锚点机械定位；禁止缺失/仍为 `PRD#API-###`
  - 一致性：`9.2` 中出现的每个 `API-###` 都必须在 `9.3` 有对应详情；`9.3` 中出现的 `API-###` 也必须在 `9.2` 清单中存在

**数据表（如适用）**
- PRD `8.1 表清单`：每张表建议提供 `TBL-###`（`TBL-001` 形式）；若提供则不得重复且不得为 `TBL-###`
- PRD `8.2 表定义`：若存在表定义小节，其标题必须包含对应 `TBL-###`（具体数字：`TBL-001` 形式）
- PRD `8.2 表定义`：每个表定义标题行必须以 `#### 8.2.` 开头（标题级别/前缀固定；用于后续按块边界机械抽取）
- PRD `8.2 表定义`：若存在表定义小节，其标题行必须包含对应的锚点 `<!-- PRD#TBL-### -->`（具体数字：`<!-- PRD#TBL-001 -->` 形式），且锚点 `<ID>` 必须与标题中的 `TBL-###` 一致；用于后续按锚点机械定位；禁止缺失/仍为 `PRD#TBL-###`

### 3.5) 功能点→落点映射（必须闭合）

- 必须存在小节标题：`### 8.0 功能点→落点映射（必填）`
- 该小节下必须存在表格，且表头包含列：`FP`、`落点`
- `P_fp =` 从 PRD `5.2 功能规格` 各模块小节的「功能点」列表中抽取的所有 `FP-xx` 集合
- `M_fp =` 从 PRD `8.0` 映射表中抽取的所有 `FP-xx` 集合（取表格第一列）
- 一致性（任一不满足即 `FAIL`）：
  - 覆盖：`P_fp` 中每个 `FP-xx` 都必须在 `M_fp` 中出现且仅出现 1 次
  - 不得多写：`M_fp` 不得出现 `P_fp` 中不存在的 `FP-xx`
  - 不得重复：`8.0` 表内 `FP-xx` 不得重复
- 落点字段合法性（任一不满足即 `FAIL`）：
  - 允许值：`N/A` 或（逗号分隔的多项集合）
  - 每项必须以以下前缀之一开头：`DB:` / `FILE:` / `CFG:` / `EXT:`
  - 若出现 `DB:TBL-###`：必须为具体数字（`DB:TBL-001` 形式，禁止 `DB:TBL-###`），且对应 `TBL-###` 必须能在 PRD `8.2` 中通过锚点 `<!-- PRD#TBL-### -->` 唯一定位

### 4) 规则与模块最小可用性

- PRD 第 6 节必须包含规则表（表头包含 `| 规则ID |`）；且必须至少 1 行数据；每行 `规则ID` 必须为 `BR-001` 形式且唯一；不得出现 `BR-###`
- `5.1 功能清单` 表中至少包含 1 个优先级为 `P0` 的模块（否则 `FAIL`）

## PASS（通过后动作）

- `PASS`：仅提示下一步动作：
  - 从现在开始，后续任何步骤都不要修改 `docs/PRD.md` 的任何内容；如需修改，请回到 `/prd` 更新 PRD 并重跑后续步骤
  - 然后在新窗口运行 `/scaffold` 生成 `docs/GLOBAL-CONTEXT.md`
