# 阶段1b: PRD 校验（v1）

读取 `docs/PRD.md`，输出 `FAIL/DECISION/PASS` 清单用于回到 `/prd` 补齐；**不修改任何文件**。

## 读取

- `docs/PRD.md`

## 输出（只读）

只输出问题清单与修复建议。不输出 PRD 原文。

输出规则：
- 如存在任何 `FAIL`：只输出 `FAIL` 条目并结束（不输出 `PASS`）
- 仅当无 `FAIL`：可输出 `DECISION`（若有）或 `PASS`

## FAIL 校验项（机械性门禁）

### 0) 文件与状态

- `docs/PRD.md` 必须存在
- 顶部必须包含 `状态:` 行，且值只能是 `Draft` 或 `Final`

### 1) 结构完整性（不得缺章）

必须包含以下一级章节（缺失即 `FAIL`）：

- `## 1. 项目概述`
- `## 2. 范围与假设`
- `## 3. 目标用户与角色`
- `## 4. 权限矩阵（必填）`
- `## 5. 核心功能`
- `## 6. 业务规则（必填）`
- `## 7. 状态与枚举（必填）`
- `## 8. 数据模型（必填）`
- `## 9. 接口设计（必填）`
- `## 10. 非功能需求（必填，可写 N/A）`

### 2) 模板占位符（不得残留）

若仍包含未替换的模板占位符，视为 `FAIL`。重点拦截：`[...]`、`[项目名称]`、`[模块名]`、`[table]`、`[table_name]`、`[field]`、`[METHOD]`。

> 例外：
> - 形如 `[G-01]` 的编号样式允许保留
> - 仅允许在 PRD 顶部 `> 稳定ID:` 说明行出现 `API-###` / `TBL-###`（格式约定）；除此之外若出现 `API-###` / `TBL-###`，视为占位符未替换

### 3) 稳定ID（接口/表）一致性

**接口（必过）**
- PRD `9.2 接口清单`：每条接口必须有且仅有一个 `API-###`，且必须是具体数字（`API-001` 形式）；禁止缺失/重复/仍为 `API-###`
- PRD `9.3 接口详情`：每个详情标题必须包含对应的 `API-###`
- 一致性：`9.2` 中出现的每个 `API-###` 都必须在 `9.3` 有对应详情；`9.3` 中出现的 `API-###` 也必须在 `9.2` 清单中存在

**数据表（如适用）**
- PRD `8.1 表清单`：每张表建议提供 `TBL-###`（`TBL-001` 形式）；若提供则不得重复且不得为 `TBL-###`
- PRD `8.2 表定义`：若存在表定义小节，其标题建议包含对应 `TBL-###`

### 4) 规则与模块最小可用性

- 在 `6. 业务规则` 的规则表（表头包含 `| 规则ID |`）中：每行 `规则ID` 必须为 `BR-001` 形式且唯一；不得出现 `BR-###`
- `5.1 功能清单` 表中至少包含 1 个优先级为 `P0` 的模块（否则 `FAIL`）

## DECISION（需要用户确认）

- `状态: Final` 但仍存在 `FAIL`：需要用户确认是否将状态改回 `Draft` 后继续补齐（否则下游引用会不稳定）

## PASS（通过后动作）

- `PASS`：仅提示下一步动作：
  - 若用户已确认定稿：手动将 PRD 顶部 `状态` 改为 `Final` 并冻结 `docs/PRD.md`
  - 然后在新窗口运行 `/scaffold` 生成 `docs/GLOBAL-CONTEXT.md`
