# 阶段2b: GLOBAL-CONTEXT 校验

读取：`docs/GLOBAL-CONTEXT.md` | 写入：无（只输出 `FAIL/DECISION/PASS`；不修改文件） | 模板：`N/A`

输出 `FAIL/DECISION/PASS` 清单用于回到 `/scaffold` 修正；**不修改任何文件**。

## 输出规则（只读）

- 不输出 GC 原文
- 若存在任何 `FAIL`：
  - 输出 `FAIL` 清单（`F-001` 起编号；每条必须包含：问题 / 影响 / 修复方式（只给 1 个动作或命令））
  - 末尾追加：
    - `修正：将 FAIL 清单作为可选输入粘贴给 /scaffold，逐条修正 docs/GLOBAL-CONTEXT.md`
    - `重跑：/scaffold-check`
  - 然后结束
- 仅当无 `FAIL`：输出 `DECISION`（若有）或 `PASS`

## FAIL 校验项（机械性门禁）

### 0) 文件存在

- `docs/GLOBAL-CONTEXT.md` 必须存在

### 1) 结构完整性（不得缺章）

必须包含以下一级章节（缺失即 `FAIL`）：

- `## 1. 技术栈（必填）`
- `## 2. 项目结构（必填）`
- `## 3. 枚举值定义（必填；无则写 N/A）`
- `## 4. 业务规则（必填）`
- `## 5. 权限矩阵（必填）`
- `## 6. 数据模型概览（必填；如无 DB 写 N/A）`
- `## 7. 命名规范（如适用；否则写 N/A）`
- `## 8. API规范（必填）`

### 2) 模板占位符（不得残留）

在非代码块内容中（忽略 ``` fenced code blocks），不得残留任何模板占位符；命中即 `FAIL`。

机械拦截（任一命中即 `FAIL`）：
- `[...]`
- `BR-###`（仍为占位）
- 方括号使用规则（避免误伤路由/路径）：在非代码块内容中若出现 `[` 或 `]`：
  - 允许：Markdown 链接 `[text](...)`
  - 允许：路径/路由等“包含 `/` 或 `\\` 的字符串”中的方括号（如 `pages/[slug].tsx`、`/posts/[slug]`）
  - 其余一律视为模板占位符残留 → `FAIL`

### 3) 规则表最小可用性

- 在第 4 节业务规则表（表头包含 `| ID |`）中：
  - 必须存在规则表（表头包含 `| ID |`），且至少 1 行数据
  - ID 列必须包含至少 1 条 `BR-001` 形式的 ID
  - ID 列中的 `BR-001` 形式 ID 必须唯一
  - 不得出现占位符 `BR-###`

### 4) 噪音控制（不得把 PRD 片段塞进 GC）

- `docs/GLOBAL-CONTEXT.md` 中不得出现任何 **PRD 锚点引用**（出现即 `FAIL`），包括任何 `PRD#...`
- 允许出现 `docs/PRD.md` 作为“来源文件名/描述”（例如“由 PRD 抽取生成”）；但禁止引用 PRD 的具体位置/片段（如 `PRD#API-001`、PRD 章节号定位、或复制 PRD 原文大段）

### 5) `TBD` 位置（必须）

- `TBD` 仅允许出现在：
  - 第 4 节业务规则表的 “涉及Story” 列
- 若在其它任何位置出现 `TBD`：视为 `FAIL`

### 6) 项目验证命令表（必须存在；可为 N/A）

- 在第 2 节 `## 2. 项目结构（必填）` 中必须包含小节：`### 项目验证命令（如适用；否则写 N/A）`
- 该小节下必须存在表格，且表头必须为：`| 类型 | 命令 | 说明 |`
- 表格必须至少包含 1 行数据（不含表头与分隔行）
- 每行必须包含 3 列：`类型` / `命令` / `说明`（按 `|` 分隔）
- `类型` 必须为以下之一：
  - `gate:<name>`（失败阻断）
  - `opt:<name>`（失败仅记录 DECISION）
  - `N/A`
- 若某行 `命令 = N/A`：该行 `类型` 与 `说明` 也必须为 `N/A`
- 若某行 `命令 != N/A`：该行 `类型` 必须以 `gate:` 或 `opt:` 开头；不得为 `N/A`

## DECISION（不阻断；提示补充即可）

- 若“项目验证命令”表存在，但所有数据行的 `命令` 都为 `N/A`：
  - 输出 `DECISION`：提示该项目暂无可自动执行的验证步骤，后续 `/story N` 将只能做“按验收标准的人工验证/自检”，建议在合适时补充至少 1 条可重复执行的验证命令
  - 约定：新增命令行时 `类型` 必须为 `gate:<name>` 或 `opt:<name>`（见第 6) 门禁）
  - 末尾追加：
    - `接受 DECISION：继续 /split-plan`
    - `不接受 DECISION：先 /scaffold 补齐后重跑 /scaffold-check`

## PASS（通过后动作）

- `PASS`：仅提示下一步动作：
  - `/split-plan`（生成 `docs/split-plan.yaml`）
