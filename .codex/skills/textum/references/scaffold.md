# 阶段2: 上下文提取

读取：`docs/PRD.md`（只读） | 写入：`docs/GLOBAL-CONTEXT.md` | 模板：`.codex/skills/textum/assets/GLOBAL-CONTEXT-template.md` | 可选输入：`FAIL/DECISION` 清单

从 PRD 抽取生成 GLOBAL-CONTEXT：只抽取/归纳；不新增信息。

## 输入（可选）

- `FAIL/DECISION` 清单（用于精准修正）

## 修正模式（当提供 `FAIL/DECISION` 清单时必须遵守）

- 以现有 `docs/GLOBAL-CONTEXT.md` 为基线：**只修改清单命中的位置**，其余内容不做无关改动（最小 diff）
- 若清单需要补充事实但 PRD 无法支撑：不要新增信息；保持 `N/A` 并输出 `DECISION` 提示用户先更新 PRD 后重跑本阶段

## 硬约束（必须遵守）

`N/A_STRICT` 判定口径（权威；逐字一致；禁止改写）：
- 定位 PRD 小节 `### 9.2 接口清单（必填）` 的正文（标题行之后到下一同级小节标题之前）
- 判定 `N/A_STRICT = true` 当且仅当：正文去掉空行并 Trim 后仅剩 1 行且该行严格等于 `N/A`

- 只做抽取/归纳：不得新增 PRD 中不存在的新规则/新枚举/新接口/新字段/新默认值
- 禁止占位符：输出中不得出现 `TBD` / `[...]`
- 禁止 fenced code blocks：输出中不得出现任何 ```
- 禁止 PRD 锚点：`docs/GLOBAL-CONTEXT.md` 中不得出现任何 `PRD#...` 或 `<!-- PRD#... -->`
- 技术栈（GC 第 1 节）：只允许从 PRD 显式抽取；PRD 未提供则写 `N/A`；不得猜测/推荐
- 若提供 `FAIL/DECISION` 清单：必须逐条完成清单中的“修复方式/建议动作”
- 必须按模板输出全部一级章节：
  - 模板中为 `N/A` 的小节：保持该小节正文仅一行 `N/A`（不加额外解释）
  - 模板中为表格的小节：无信息则保留 `N/A` 行/单元格（不加额外解释）

## 抽取口径（按节；只取“已确认事实”）

- 第 1 节 技术栈：只写 PRD 明确出现的语言/框架/数据库等；否则保持 `N/A`
- 第 2 节 项目结构：
  - `| Path | 职责 |` 表：仅列 PRD `8.0 功能点→落点映射` 中出现的 `FILE:<path>`（去重；Path 写 `<path>`，去掉 `FILE:` 前缀）
  - `### 项目验证命令` 表：PRD 未提供可执行命令则保持 `N/A`
- 第 3 节 枚举值：从 PRD 第 7 节抽取；无则 `N/A`
- 第 4 节 业务规则：从 PRD 第 6 节规则表抽取 `BR-###` 与一句话规则描述（不扩写、不补充）
- 第 5 节 权限矩阵：从 PRD 第 4 节抽取为行式表格 `操作|角色|权限|说明`（权限只能 `A` / `D` / `O`）
- 第 6 节 数据模型概览：仅抽取 PRD `8.1 表清单` 与 `8.3 表关系` 的摘要；无则 `N/A`（不要复制 `8.2` 字段表）
- 第 7 节 命名规范：仅抽取 PRD 明确给出的命名约定；无则 `N/A`
- 第 8 节 API规范：
  - 先按 `N/A_STRICT` 判定 PRD 是否有 API
  - 若无 API：该节正文必须严格为 1 行 `N/A`
  - 若有 API：只抽取 PRD `9.1 通用约定` 中已确认的项；缺失项写 `N/A`；不要新增默认错误码/示例 JSON

## 最小读取范围（必须；避免通读）

- PRD：`4`（权限矩阵）、`6`（规则表）、`7.1/7.2`（枚举/状态机）、`7.3`（命名规范；若正文为单行 `N/A` 则 GC 第 7 节保持单行 `N/A`）、`8.0`（落点映射）、`8.1/8.3`（表清单/关系）、`9.1/9.2`（API 约定/清单；若 `N/A_STRICT` 则跳过）、`10`（非功能底线）

## 完成后

- 输出：`已写入：docs/GLOBAL-CONTEXT.md`
- 下一步：GLOBAL-CONTEXT 校验
